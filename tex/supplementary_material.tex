\documentclass[11pt]{article}

\usepackage[affil-it]{authblk} 
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}
\usepackage{lscape}
\usepackage{multirow}
\usepackage{siunitx}  % use \si{\angstrom} for Angstrom
\title{Supplementary material: ``High-productivity, high-performance workflow for virus-scale electrostatic simulations with Bempp-Exafmm''}
\author[1]{\small Tingyu Wang}
\author[2]{\small Christopher D. Cooper}
\author[3]{\small Timo Betcke}
\author[1]{\small Lorena A. Barba\thanks{Corresponding author.}}
\affil[1]{\footnotesize Department of Mechanical and Aerospace Engineering, The George Washington University, Washington, DC, USA}
\affil[2]{\footnotesize Department of Mechanical Engineering and Centro Cient\'ifico Tecnol\'ogico de Valpara\'iso, Universidad T\'ecnica Federico Santa Mar\'ia, Valpara\'iso, Chile}
\affil[3]{\footnotesize Department of Mathematics, University College London, UK}

\begin{document}
\maketitle

% add comparison with results from APBS
\section*{Agreement of solvation energy calculations with APBS}
We build more confidence on Bempp-Exafmm by comparing our results with the finite-difference version of APBS (version 1.5), using 5PTI and 8 other molecules.
We prepared the molecular structures using the \texttt{charmm} force field.
For each molecule, we created three successive meshes to study the convergence with each software.
For Bempp-Exafmm, we used \texttt{Nanoshaper} to generate three surface meshes with the element density set to 4, 8, 16 ${\si{\angstrom}}^{-2}$, respectively.
In APBS, we controlled the multigrid parameters to ensure that three grid spacings are refined with a constant factor of 2.
Table \ref{tab:APBS_mesh} summarizes the mesh sizes of the molecules used in the convergence study of APBS and Bempp.
The former uses Cartesian grids while the latter uses surface meshes generated by \texttt{Nanoshaper}.
Other parameters are the same as our previous grid-convergence study, as listed in Table 1 in our paper.

Table \ref{tab:APBS_result} presents the convergence results of both codes using a set of molecules.
Bempp used the derivative formulation throughout.
In each case, we obtained an extrapolated value of the solvation energy of each molecule, which serves as the reference value to estimate the discretization error with each software.
As expected, the solvation energy computed from Bempp converges at the rate of $\mathcal{O}(N^{-1})$, where $N$ is the number of elements.
With APBS, the average observed order of convergence over all cases is 1.25, with respect to the grid spacing $h$; other studies \cite{CooperBardhanBarba2014,GengKrasny2013} have reported a similar rate. 
Our $\mathcal{O}(N^{-1})$ convergence corresponds to $\mathcal{O}(h^{-2})$ convergence in grid size, but for boundary elements (surface triangles) it is more natural to look at convergence with respect to $N$.
The difference in the extrapolated solvation energies obtained with the two codes varies between 0.8\% and 1.8\% across all cases.
A discrepancy is expected because (1) Bempp-Exafmm and APBS use different geometrical representations for the molecular surface, (2) the atomic charges in the molecule are mapped to grid points through interpolation in APBS, while Bempp treats them analytically and (3) the far-field boundary condition is exactly imposed in Bempp.
Furthermore, as Oberkampf and Roy \cite{oberkampf_roy_2010} remark on code verification, this discrepancy could be due to model differences since Bempp and APBS use different discrete equations.
We should only expect the same results when the same exact algorithm is employed.

\bigskip

Readers can find the input files and results in this folder in the manuscript repository: \url{https://github.com/barbagroup/bempp_exafmm_paper/tree/master/repro-pack/runs/APBS_result}.

Readers can also find a Jupyter Notebook with the post-processing of results here: \url{https://github.com/barbagroup/bempp_exafmm_paper/blob/master/repro-pack/notebooks/compare_with_other_software.ipynb}.


\begin{table}[]
  \centering
  \begin{tabular}{c|cc|cc}
       & \multicolumn{2}{c|}{APBS}                     & \multicolumn{2}{c}{Bempp}                   \\
  ID   & $N_{grid}$ & $h_x, h_y, h_z (\si{\angstrom})$ & $N_{elem}$ & density $(1/\si{\angstrom}^2)$ \\ \hline
  1AJJ & $65^3$     & 0.65, 0.71, 0.79                 & 8,544      & 4                              \\
       & $129^3$    & 0.33, 0.36, 0.40                 & 17,200     & 8                              \\
       & $257^3$    & 0.17, 0.18, 0.20                 & 34,468     & 16                             \\ \hline
  1VJW & $97^3$     & 0.46, 0.56, 0.51                 & 11,544     & 4                              \\
       & $193^3$    & 0.23, 0.28, 0.25                 & 23,296     & 8                              \\
       & $385^3$    & 0.12, 0.14, 0.13                 & 46,660     & 16                             \\ \hline
  5PTI & $97^3$     & 0.46, 0.56, 0.51                 & 12,512     & 4                              \\
       & $193^3$    & 0.23, 0.28, 0.25                 & 25,204     & 8                              \\
       & $385^3$    & 0.12, 0.14, 0.13                 & 50,596     & 16                             \\ \hline
  1R69 & $97^3$     & 0.59, 0.54, 0.51                 & 12,004     & 4                              \\
       & $193^3$    & 0.30, 0.27, 0.25                 & 24,216     & 8                              \\
       & $385^3$    & 0.15, 0.14, 0.13                 & 48,648     & 16                             \\ \hline
  1A2S & $65^3$     & 0.92, 0.87, 1.01                 & 17,784     & 4                              \\
       & $129^3$    & 0.46, 0.44, 0.51                 & 35,732     & 8                              \\
       & $257^3$    & 0.23, 0.22, 0.25                 & 71,648     & 16                             \\ \hline
  1SVR & $97^3$     & 0.62, 0.68, 0.70                 & 18,644     & 4                              \\
       & $193^3$    & 0.31, 0.34, 0.35                 & 37,348     & 8                              \\
       & $385^3$    & 0.16, 0.17, 0.18                 & 75,004     & 16                             \\ \hline
  1A63 & $129^3$    & 0.82, 0.50, 0.51                 & 27,996     & 4                              \\
       & $257^3$    & 0.41, 0.25, 0.25                 & 56,356     & 8                              \\
       & $513^3$    & 0.21, 0.13, 0.13                 & 113,124    & 16                             \\ \hline
  1A7M & $129^3$    & 0.52, 0.77, 0.63                 & 30,576     & 4                              \\
       & $257^3$    & 0.26, 0.39, 0.32                 & 61,652     & 8                              \\
       & $513^3$    & 0.13, 0.19, 0.16                 & 123,776    & 16                             \\ \hline
  1F6W & $129^3$    & 0.98, 0.79, 0.91                 & 77,464     & 4                              \\
       & $257^3$    & 0.49, 0.40, 0.46                 & 156,140    & 8                              \\
       & $513^3$    & 0.25, 0.20, 0.23                 & 313,692    & 16                            
  \end{tabular}
  \caption{Mesh sizes of the molecules used in the convergence study of APBS and Bempp.
  $h_x$, $h_y$ and $h_z$ are the grid spacings in $x$, $y$, $z$ direction.}
  \label{tab:APBS_mesh}
\end{table}

\begin{landscape}
\begin{table}[]
    \centering
    \resizebox{1.4\textheight}{!}{%
    \begin{tabular}{cc|ccc|cc|ccc|cc}
      &   & \multicolumn{5}{c|}{APBS}                                                                    & \multicolumn{5}{c}{Bempp}                                                                   \\
      &   & \multicolumn{3}{c|}{Error}     & \multirow{2}{*}{$\Delta G_{solv}$} & \multirow{2}{*}{Order$(1/h)$} & \multicolumn{3}{c|}{Error}     & \multirow{2}{*}{$\Delta G_{solv}$} & \multirow{2}{*}{Order$(1/N)$} \\
    ID   & $N_{atoms}$ & coarse   & medium   & fine     &                                    &                        & coarse   & medium   & fine     &                                    &                        \\ \hline
    1AJJ & 513 & 4.40e-02 & 1.33e-02 & 4.00e-03 & -266.15                            & 1.73                   & 2.75e-02 & 1.12e-02 & 4.59e-03 & -268.67                            & 1.29                   \\
    1VJW & 826 & 3.09e-02 & 1.45e-02 & 6.77e-03 & -297.06                            & 1.09                   & 4.92e-02 & 2.23e-02 & 1.01e-02 & -302.50                            & 1.14                   \\
    5PTI & 892 & 3.68e-02 & 1.38e-02 & 5.14e-03 & -311.69                            & 1.42                   & 5.12e-02 & 2.23e-02 & 9.67e-03 & -314.34                            & 1.20                   \\
    1R69 & 997 & 4.31e-02 & 2.10e-02 & 1.02e-02 & -261.02                            & 1.04                   & 5.09e-02 & 2.34e-02 & 1.08e-02 & -265.02                            & 1.12                   \\
    1A2S & 1272 & 5.25e-02 & 2.40e-02 & 1.10e-02 & -456.56                            & 1.13                   & 4.21e-02 & 1.93e-02 & 8.86e-03 & -461.25                            & 1.12                   \\
    1SVR & 1433 & 5.28e-02 & 2.21e-02 & 9.28e-03 & -393.45                            & 1.25                   & 6.48e-02 & 2.89e-02 & 1.29e-02 & -398.83                            & 1.16                   \\
    1A63 & 2065 & 4.51e-02 & 1.88e-02 & 7.82e-03 & -559.39                            & 1.26                   & 5.82e-02 & 2.60e-02 & 1.16e-02 & -567.24                            & 1.16                   \\
    1A7M & 2804 & 4.13e-02 & 1.88e-02 & 8.53e-03 & -524.29                            & 1.14                   & 4.93e-02 & 2.24e-02 & 1.02e-02 & -531.48                            & 1.14                   \\
    1F6W & 8247 & 6.45e-02 & 2.78e-02 & 1.20e-02 & -1277.51                           & 1.21                   & 4.18e-02 & 1.80e-02 & 7.76e-03 & -1301.08                           & 1.22                     
    \end{tabular}
    }
    \caption{Convergence results of the solvation energy of 9 molecules using APBS and Bempp with derivative formulation.
    The error is with respect to an extrapolated value of the solvation energy using Richardson extrapolation.
    The solvation energy $\Delta G_{solv}$ is in units of kcal/mol.
    The observed order of convergence is with respect to the grid spacing $h$ for APBS (volumetric-based solver) and with respect to the number of elements $N$ for Bempp (boundary-element solver).}
    \label{tab:APBS_result}
\end{table}
\end{landscape}

\bibliography{./reference}{}
\bibliographystyle{elsarticle-num}

\end{document}